<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="UTF-8">
  <title>CRUD Pacientes Supabase</title>
  <style>
    table, th, td { border: 1px solid black; border-collapse: collapse; padding: 5px; }
    input, select { margin: 5px; }
    .form-container { margin-bottom: 20px; }
  </style>
</head>
<body>
  <h2>Gesti√≥n de Pacientes</h2>

  <div class="form-container">
    <form id="formPaciente">
      <input type="hidden" name="pacienteid" id="pacienteid">
      <label>Nombre: <input type="text" name="nombre" required></label>
      <label>Apellido: <input type="text" name="apellido" required></label>
      <label>Fecha Nacimiento: <input type="date" name="fechanacimiento" required></label>
      <label>Sexo: 
        <select name="sexo" required>
          <option value="M">Masculino</option>
          <option value="F">Femenino</option>
        </select>
      </label>
      <label>Direcci√≥n: <input type="text" name="direccion" required></label>
      <label>Tipo ID: <input type="text" name="tipoidentificacion" required></label>
      <label>N√∫mero ID: <input type="text" name="numeroidentificacion" required></label>
      <button type="submit">Guardar</button>
      <button type="button" onclick="resetForm()">Cancelar</button>
    </form>
  </div>

  <table id="tablaPacientes">
    <thead>
      <tr>
        <th>ID</th><th>Nombre</th><th>Apellido</th><th>Fecha Nac.</th><th>Sexo</th><th>Direcci√≥n</th><th>Tipo ID</th><th># ID</th><th>Acciones</th>
      </tr>
    </thead>
    <tbody></tbody>
  </table>

  <script>
    const API_URL = 'YOUR_URL';
    const HEADERS = {
      'Content-Type': 'application/json',
      'apikey': 'SUPABASE_CLIENT_ANON_KEY',
      'Authorization': 'Bearer SUPABASE_CLIENT_ANON_KEY'
    };

    const form = document.getElementById('formPaciente');
    const tbody = document.querySelector('#tablaPacientes tbody');

    form.addEventListener('submit', async (e) => {
      e.preventDefault();
      const data = Object.fromEntries(new FormData(form));
      const isUpdate = data.pacienteid;

      try {
        const res = await fetch(isUpdate ? `${API_URL}?pacienteid=eq.${data.pacienteid}` : API_URL, {
          method: isUpdate ? 'PATCH' : 'POST',
          headers: HEADERS,
          body: JSON.stringify(data)
        });

        if (res.ok) {
          alert(isUpdate ? '‚úÖ Paciente actualizado' : '‚úÖ Paciente creado');
          form.reset();
          loadPacientes();
        } else {
          const error = await res.json();
          alert('‚ùå Error: ' + (error.message || JSON.stringify(error)));
        }
      } catch (err) {
        alert('‚ùå Error de red');
        console.error(err);
      }
    });

    async function loadPacientes() {
      tbody.innerHTML = '';
      const res = await fetch(API_URL + '?select=*', { headers: HEADERS });
      const data = await res.json();

      data.forEach(p => {
        const row = document.createElement('tr');
        row.innerHTML = `
          <td>${p.pacienteid}</td>
          <td>${p.nombre}</td>
          <td>${p.apellido}</td>
          <td>${p.fechanacimiento}</td>
          <td>${p.sexo}</td>
          <td>${p.direccion}</td>
          <td>${p.tipoidentificacion}</td>
          <td>${p.numeroidentificacion}</td>
          <td>
            <button onclick='editPaciente(${JSON.stringify(p)})'>‚úèÔ∏è</button>
            <button onclick='deletePaciente(${p.pacienteid})'>üóëÔ∏è</button>
          </td>
        `;
        tbody.appendChild(row);
      });
    }

    function editPaciente(p) {
      for (const key in p) {
        if (form[key]) form[key].value = p[key];
      }
    }

    async function deletePaciente(id) {
      if (!confirm('¬øEliminar paciente?')) return;
      const res = await fetch(`${API_URL}?pacienteid=eq.${id}`, {
        method: 'DELETE',
        headers: HEADERS
      });
      if (res.ok) {
        alert('‚úÖ Paciente eliminado');
        loadPacientes();
      } else {
        alert('‚ùå Error al eliminar');
      }
    }

    function resetForm() {
      form.reset();
      form.pacienteid.value = '';
    }

    loadPacientes();
  </script>
</body>
</html>